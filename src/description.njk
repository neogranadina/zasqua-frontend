---
pagination:
  data: descriptions
  size: 1
  alias: desc
permalink: "/{{ desc.reference_code | safeSlug }}/"
layout: base.njk
eleventyComputed:
  title: "{{ desc.title }}"
---

{# Pagefind metadata (filters, sorting, meta â€” work outside data-pagefind-body) #}
{% set repo = desc._repo %}
<div style="display:none">
  <span data-pagefind-filter="repository">{{ repo.short_name or repo.name if repo else desc.repository_code }}</span>
  <span data-pagefind-filter="level">{{ ui.levels[desc.description_level] or desc.description_level }}</span>
  <span data-pagefind-filter="digital_status">{% if desc.has_digital %}zasqua{% else %}none{% endif %}</span>
  {% set startYear = desc.date_start | extractYear %}
  {% if startYear %}<span data-pagefind-filter="year">{{ startYear }}</span>{% endif %}
  <span data-pagefind-sort="title">{{ desc.title }}</span>
  <span data-pagefind-sort="date">{{ startYear or '' }}</span>
  <span data-pagefind-meta="reference_code">{{ desc.reference_code }}</span>
  <span data-pagefind-meta="repository_code">{{ desc.repository_code }}</span>
  <span data-pagefind-filter="parent_reference_code">{{ desc.parent_reference_code or '' }}</span>
  <span data-pagefind-meta="repository_name">{{ repo.short_name or repo.name if repo else desc.repository_code }}</span>
  <span data-pagefind-meta="description_level">{{ desc.description_level }}</span>
  <span data-pagefind-meta="date_expression">{{ desc.date_expression or '' }}</span>
  <span data-pagefind-meta="digital_status">{% if desc.has_digital %}zasqua{% else %}none{% endif %}</span>
</div>

{# Breadcrumb #}
{% set ancestors = desc._ancestors %}
<nav class="breadcrumb" aria-label="Breadcrumb" data-pagefind-ignore>
  <div class="container">
    <a href="/">{{ ui.breadcrumb.home }}</a>
    {% for ancestor in ancestors %}
      <span class="breadcrumb-separator">&rsaquo;</span>
      <a href="/{{ ancestor.reference_code | safeSlug }}/">{{ ancestor.title }}</a>
    {% endfor %}
    <span class="breadcrumb-separator">&rsaquo;</span>
    <span>{{ desc.title }}</span>
  </div>
</nav>

{# Header #}
<div class="detail-header" data-pagefind-body>
  <div class="container">
    <h1 class="detail-title">{{ desc.title }}</h1>
    <div class="detail-meta">
      <span class="level-badge">{{ ui.levels[desc.description_level] or desc.description_level }}</span>
      {% if desc.date_expression %} &middot; {{ desc.date_expression }}{% endif %}
      &middot; {{ desc.reference_code }}
    </div>
  </div>
</div>

{# Two-column layout #}
<div class="detail-content">
  <div class="container">
    <div class="desc-layout">

      {# Left column: metadata #}
      <div class="desc-metadata" data-pagefind-body>

        {# Section: Descripcion #}
        {% if desc.scope_content or desc.extent or desc.arrangement %}
          <div class="detail-section">
            <h3>{{ ui.description.metadataHeader }}</h3>

            {% if desc.scope_content %}
              <div class="detail-field">
                <span class="detail-label">{{ ui.fields.scopeContent }}</span>
                {% set scParts = desc.scope_content | splitPipe %}
                {% if scParts.length > 1 %}
                  <ul class="detail-value detail-list">
                    {% for part in scParts %}<li>{{ part }}</li>{% endfor %}
                  </ul>
                {% else %}
                  <span class="detail-value">{{ desc.scope_content }}</span>
                {% endif %}
              </div>
            {% endif %}

            {% if desc.extent %}
              <div class="detail-field">
                <span class="detail-label">{{ ui.fields.extent }}</span>
                {% set extParts = desc.extent | splitPipe %}
                {% if extParts.length > 1 %}
                  <ul class="detail-value detail-list">
                    {% for part in extParts %}<li>{{ part }}</li>{% endfor %}
                  </ul>
                {% else %}
                  <span class="detail-value">{{ desc.extent }}</span>
                {% endif %}
              </div>
            {% endif %}

            {% if desc.arrangement %}
              <div class="detail-field">
                <span class="detail-label">{{ ui.fields.arrangement }}</span>
                <span class="detail-value">{{ desc.arrangement }}</span>
              </div>
            {% endif %}
          </div>
        {% endif %}

        {# Section: Condiciones de acceso #}
        {% if desc.access_conditions or desc.language %}
          <div class="detail-section">
            <h3>{{ ui.description.accessConditionsHeader }}</h3>

            {% if desc.access_conditions %}
              <div class="detail-field">
                <span class="detail-label">{{ ui.fields.accessConditions }}</span>
                <span class="detail-value">{{ desc.access_conditions }}</span>
              </div>
            {% endif %}

            {% if desc.language %}
              <div class="detail-field">
                <span class="detail-label">{{ ui.fields.language }}</span>
                <span class="detail-value">{{ desc.language }}</span>
              </div>
            {% endif %}
          </div>
        {% endif %}

        {# Section: Notas #}
        {% if desc.notes %}
          <div class="detail-section">
            <h3>{{ ui.description.notesHeader }}</h3>
            <div class="detail-field">
              <span class="detail-value">{{ desc.notes }}</span>
            </div>
          </div>
        {% endif %}

        {# Section: Personas y entidades #}
        {% if desc.creator_display %}
          <div class="detail-section">
            <h3>{{ ui.description.entitiesHeader }}</h3>
            <div class="detail-field">
              <span class="detail-label">{{ ui.roles.creator }}</span>
              <span class="detail-value">{{ desc.creator_display }}</span>
            </div>
          </div>
        {% endif %}

        {# Section: Lugares #}
        {% if desc.place_display %}
          <div class="detail-section">
            <h3>{{ ui.description.placesHeader }}</h3>
            <div class="detail-field">
              <span class="detail-value">{{ desc.place_display }}</span>
            </div>
          </div>
        {% endif %}

        {# Section: Children #}
        {% if desc.has_children %}
          <div class="detail-section" data-pagefind-ignore>
            <h3>{{ ui.description.childrenHeader }}</h3>
            {% include "children-tree.njk" %}
          </div>
        {% endif %}

      </div>

      {# Right column: aside (only for descriptions without children) #}
      {% if not desc.has_children %}
        <div class="desc-aside">
          {% if desc.iiif_manifest_url %}
            {# State 1: IIIF viewer #}
            <div class="desc-viewer" data-manifest="{{ desc.iiif_manifest_url }}"></div>
          {% else %}
            {# State 2: Not digitised notice #}
            <div class="desc-notice">
              <span class="material-symbols-outlined desc-notice-icon">inventory_2</span>
              <div class="desc-notice-title">{{ ui.description.notDigitised }}</div>
              <p class="desc-notice-text">{{ ui.description.notDigitisedText }}</p>
              {% if repo %}
                <p class="desc-notice-repo">{{ repo.name }}{% if repo.city %}, {{ repo.city }}{% endif %}</p>
              {% endif %}
            </div>
          {% endif %}
        </div>
      {% endif %}

    </div>
  </div>
</div>

{# OCR text: indexed for search but never displayed #}
{% if desc.ocr_text %}
  <div data-pagefind-body data-pagefind-weight="0.5" hidden>{{ desc.ocr_text }}</div>
{% endif %}

{% block head %}
  {% if desc.iiif_manifest_url %}
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/tify@0.31.0/dist/tify.css">
  {% endif %}
{% endblock %}

{% block scripts %}
  {% if desc.iiif_manifest_url %}
    <script src="https://cdn.jsdelivr.net/npm/tify@0.31.0/dist/tify.js"></script>
  {% endif %}
  <script src="/js/description.js"></script>
{% endblock %}
